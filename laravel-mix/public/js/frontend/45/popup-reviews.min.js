/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = 2);
/******/ })
/************************************************************************/
/******/ ({

/***/ "./resources/assets_45/js/frontend/config.js":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony default export */ __webpack_exports__["a"] = ({
    shop_url: Object({"NODE_ENV":"development"}).MIX_APP_URL || "https://" + window.location.host + "/a"
});

/***/ }),

/***/ "./resources/assets_45/js/frontend/popup-reviews.js":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__config__ = __webpack_require__("./resources/assets_45/js/frontend/config.js");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__statistics_popup_reviews__ = __webpack_require__("./resources/assets_45/js/frontend/statistics-popup-reviews.js");


document.addEventListener("DOMContentLoaded", function () {
    var isAdminLogin = false;
    // Check isAdminLogin
    var tagsSCRIPT = document.querySelectorAll('head script');
    for (var i = 0; i < tagsSCRIPT.length; i++) {
        var regex = /adminBarInjector\.init\(\)\;/m;
        var rawResult = regex.exec(tagsSCRIPT[i].outerHTML);
        if (rawResult !== null) {
            isAdminLogin = true;
            break;
        }
    }

    var ar_stop_popup_reviews = false;
    var ar_data_popup_reviews = []; // list all popup reviews
    var ar_data_popup_reviews_exist = []; // list popup reviews còn lại
    var ar_data_statistics_popup_reviews = {};
    var elShopifyAliReview = $("#shopify-ali-review");
    var alireviews_product_id = 0;
    var alireviews_list_products_in_cart = [];
    if (elShopifyAliReview.length && !elShopifyAliReview.attr("data-shop-id")) {
        alireviews_product_id = elShopifyAliReview.attr("product-id");
    }
    var shopUrl = window.Shopify.shop;
    var ar_betweenTime = 5000;
    var ar_loopPopup = 0;
    var ar_limitPopup = false;
    var ar_listCommentOld = [];

    var checkTabBrowserActiveAr = function () {
        var stateKey,
            eventKey,
            keys = {
            hidden: "visibilitychange",
            webkitHidden: "webkitvisibilitychange",
            mozHidden: "mozvisibilitychange",
            msHidden: "msvisibilitychange"
        };
        for (stateKey in keys) {
            if (stateKey in document) {
                eventKey = keys[stateKey];
                break;
            }
        }
        return function (c) {
            if (c) document.addEventListener(eventKey, c);
            return !document[stateKey];
        };
    }();

    if (typeof alireviews_page_type != 'undefined' && ar_stop_popup_reviews === false) {
        if (alireviews_page_type === 'cart') {
            $.ajax({
                method: "GET",
                url: "/cart.json",
                data: {},
                success: function success(result) {
                    if (result.item_count > 0) {
                        var list_products_in_cart = [];
                        $.each(result.items, function (index, value) {
                            list_products_in_cart.push(value.product_id);
                        });

                        alireviews_list_products_in_cart = list_products_in_cart;
                        aliReviewsListPopupReviews();
                    }
                },
                error: function error() {}
            });

            if (typeof isAdminLogin != 'undefined' && !isAdminLogin) {
                var shopId = sessionStorage.getItem('shopId');
                if (typeof shopId != 'undefined' && shopId != null) {
                    var myCookies = Object(__WEBPACK_IMPORTED_MODULE_1__statistics_popup_reviews__["a" /* getCookies */])();
                    if (sessionStorage.getItem('obj_cart') === null || sessionStorage.getItem('obj_cart') !== myCookies.cart) {
                        var _shopId = sessionStorage.getItem('shopId');
                        Object(__WEBPACK_IMPORTED_MODULE_1__statistics_popup_reviews__["b" /* statisticReviewPopup */])({
                            cart_token: myCookies.cart,
                            type: 'cart_token',
                            review_id: myCookies.review_id,
                            shop_id: _shopId
                        });
                    }
                }
            }
        } else {
            aliReviewsListPopupReviews();
        }
    }

    function aliReviewsListPopupReviews() {
        var type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "first";

        $.ajax({
            method: "POST",
            url: __WEBPACK_IMPORTED_MODULE_0__config__["a" /* default */].shop_url + "/reviews_popup/list",
            data: {
                shop_domain: shopUrl,
                isAdminLogin: isAdminLogin,
                alireviews_page_type: alireviews_page_type,
                alireviews_product_id: alireviews_product_id,
                list_products_in_cart: alireviews_list_products_in_cart,
                alireviews_collection_id: typeof alireviews_collection_id != 'undefined' ? alireviews_collection_id : '',
                list_comment_old: ar_listCommentOld
            },
            success: function success(result) {

                if (result.status) {
                    ar_data_popup_reviews = JSON.parse(JSON.stringify(result.data));

                    var data = JSON.parse(JSON.stringify(result.data));
                    sessionStorage.setItem('shopId', result.data[0].shop_id);
                    if (sessionStorage.getItem('review_id') == null || typeof sessionStorage.getItem('review_id') == 'undefined') {
                        Object(__WEBPACK_IMPORTED_MODULE_1__statistics_popup_reviews__["a" /* getCookies */])(result.data[0].shop_id);
                    }
                    if (typeof isAdminLogin != 'undefined' && !isAdminLogin) {
                        if (alireviews_page_type == 'cart') {
                            var _myCookies = Object(__WEBPACK_IMPORTED_MODULE_1__statistics_popup_reviews__["a" /* getCookies */])();
                            if (sessionStorage.getItem('obj_cart') === null || sessionStorage.getItem('obj_cart') !== _myCookies.cart) {
                                var _shopId2 = sessionStorage.getItem('shopId');
                                Object(__WEBPACK_IMPORTED_MODULE_1__statistics_popup_reviews__["b" /* statisticReviewPopup */])({ cart_token: _myCookies.cart, type: 'cart_token', review_id: _myCookies.review_id, shop_id: _shopId2 });
                            }
                        }
                    }

                    if (type == 'first') {
                        ar_loopPopup = result.loop;
                        var firtsTime = result.firstTime;

                        setTimeout(function () {
                            showPopupReviewAr(data);
                        }, firtsTime); // thời gian hiên popup đầu tiên
                    } else {
                        setTimeout(function () {
                            showPopupReviewAr(data);
                        }, ar_betweenTime); // thời gian giữa các popup
                    }
                } else {
                    // nếu còn lặp thì gọi lên lại 1 lần nữa
                    if (ar_loopPopup && parseInt(ar_loopPopup) > 0) {
                        ar_loopPopup = parseInt(ar_loopPopup) - 1;
                        // set lại list comment đã hiện bằng rỗng
                        ar_listCommentOld = [];

                        aliReviewsListPopupReviews('loop');
                    }
                }
            },
            error: function error() {}
        });
    }

    $("body").delegate(".ar-btn-click-popup-close", "click", function (e) {
        $('.mfp-move-horizontal').addClass('mfp-removing');
        $('.mfp-move-horizontal').removeClass('mfp-ready');
        setTimeout(function () {
            $('.ar-ctn-popup-reviews').remove();
        }, 200);
        ar_stop_popup_reviews = true;
    });

    $("body").delegate(".ar-btn-show-modal-reviews", "click", function (e) {
        e.preventDefault();
        var modalPopup = $(this).closest('.ar-ctn-popup-reviews').find('.ar-modal-popup-reviews');
        modalPopup.css('display', 'block');
        $('.ar-popup-reviews').remove();
        handelListReviewImage(e);
        replacePositionFlagCountry();
        if (typeof isAdminLogin != 'undefined' && !isAdminLogin) {
            ar_data_statistics_popup_reviews.type = 'click';
            ar_data_statistics_popup_reviews.is_reviews = true;
            ar_data_statistics_popup_reviews.reviewPerformance = 'true';
            Object(__WEBPACK_IMPORTED_MODULE_1__statistics_popup_reviews__["b" /* statisticReviewPopup */])(ar_data_statistics_popup_reviews);
        }

        /**
         * Modal hiện thì ngưng chạy các popup còn lại
         */
        ar_stop_popup_reviews = true;
        setTimeout(function () {
            $('body').addClass('popup-reviews-modal-open');
        });
    });
    $("body").delegate(".ar-btn-click-popup-direct", "click", function (e) {
        e.preventDefault();
        var modalPopup = $(this).closest('.ar-btn-click-popup-direct').find('.ar-btn-click-popup-direct');
        modalPopup.css('display', 'block');
        $('.ar-popup-reviews').remove();
        if (typeof isAdminLogin != 'undefined' && !isAdminLogin) {
            ar_data_statistics_popup_reviews.type = 'click';
            ar_data_statistics_popup_reviews.href = $(this).attr('href');
            ar_data_statistics_popup_reviews.target = $(this).attr('target');
            ar_data_statistics_popup_reviews.is_reviews = true;
            ar_data_statistics_popup_reviews.reviewPerformance = 'true';
            Object(__WEBPACK_IMPORTED_MODULE_1__statistics_popup_reviews__["b" /* statisticReviewPopup */])(ar_data_statistics_popup_reviews);
        } else {
            var win = window.open($(this).attr('href'), $(this).attr('target'));
            win.focus();
        }

        // ar_stop_popup_reviews = true;
        // setTimeout(function () {
        //     $('body').addClass('popup-reviews-modal-open');
        // });
    });
    $("body").delegate(".ar-modal-popup-reviews .button-close", "click", function (e) {
        /**
         * Đóng modal thì hiện popup review lại với data còn lại
         */
        ar_stop_popup_reviews = false;
        $('body').removeClass('popup-reviews-modal-open');
        setTimeout(function () {
            showPopupReviewAr(ar_data_popup_reviews_exist);
        }, ar_betweenTime); // thời gian giữa các popup
        $('.ar-ctn-popup-reviews').remove();
    });

    function showPopupReviewAr(data) {
        if (!$('.ar-ctn-popup-reviews').length) {
            var isTabActive = true;
            isTabActive = checkTabBrowserActiveAr() ? true : false;
            console.log('isTabActive', isTabActive);

            /**
             * Check tab active thì mới chạy popup
             */
            var lifetime = 5000;

            if (isTabActive === true) {
                // nếu hết data thì gọi api lên để lấy trang tiếp theo
                if (data.length < 1 || typeof data === 'undefined') {
                    aliReviewsListPopupReviews('pagination');
                    return;
                }

                var firstPopup = data.shift();
                lifetime = firstPopup.lifetime;
                ar_listCommentOld.push(firstPopup.comment_id);
                if (typeof firstPopup.betweenTime.from !== "undefined" && firstPopup.betweenTime.from) {
                    ar_betweenTime = Math.floor(Math.random() * (firstPopup.betweenTime.to - firstPopup.betweenTime.from)) + firstPopup.betweenTime.from;
                    ar_betweenTime = ar_betweenTime * 1000;
                } else {
                    ar_betweenTime = firstPopup.betweenTime;
                }
                console.log('ar_betweenTime - ' + firstPopup.comment_id, ar_betweenTime);

                ar_data_popup_reviews_exist = data;
                $('body').append(firstPopup.view);

                var avatarImage = $('.ar-popup-reviews--products-avatar img');
                if (avatarImage.length) {
                    //check if the image is already on cache
                    if (avatarImage.prop('complete')) {
                        setTimeout(function () {
                            $('.mfp-move-horizontal').addClass('mfp-ready');
                        }, 50);
                    } else {
                        /* Call the codes/function after the image is loaded */
                        avatarImage.on('load', function () {
                            setTimeout(function () {
                                $('.mfp-move-horizontal').addClass('mfp-ready');
                            }, 50);
                        });
                    }
                } else {
                    setTimeout(function () {
                        $('.mfp-move-horizontal').addClass('mfp-ready');
                    }, 50);
                }

                $('.alr-rating').length && $('.alr-rating').rating();
                /**
                 * Run statistic
                 */
                console.log("isAdminLogin", isAdminLogin);

                if (typeof isAdminLogin != 'undefined' && !isAdminLogin) {
                    // condition when display combo products

                    if (typeof firstPopup.combo != 'undefined' && firstPopup.combo != null && firstPopup.combo !== '') {
                        firstPopup.combo_id = firstPopup.combo.id;
                        firstPopup.combo_title = firstPopup.combo.title;
                        firstPopup.type_oject = 'combo';
                    }
                    firstPopup.reviewPerformance = typeof sessionStorage.getItem('reviewPerformance') != 'undefined' && sessionStorage.getItem('reviewPerformance') !== 'true' ? 'false' : 'true';
                    statisticPopupReviewAr(firstPopup);
                }
            }

            setTimeout(function () {
                ar_circlePopup(data);
            }, lifetime); // thời gian sống của 1 popup
        }
    }

    function ar_circlePopup(data) {
        if (ar_stop_popup_reviews === false) {
            // kiểm tra xem có đang hover popup không mới tắt
            var isHovered = $('.ar-popup-reviews:hover').length; // returns true or false
            console.log('isHovered', isHovered);

            if (isHovered === 0) {
                $('.mfp-move-horizontal').addClass('mfp-removing');
                $('.mfp-move-horizontal').removeClass('mfp-ready');
                setTimeout(function () {
                    $('.ar-ctn-popup-reviews').remove();
                }, 200);

                setTimeout(function () {
                    showPopupReviewAr(data);
                }, ar_betweenTime); // thời gian giữa các popup
            } else {
                /*
                Nếu đang hover popup thì cứ mỗi 1 giây lại gọi lại circle popup để khi rê chuột ra có thể chạy tiếp
                 */
                setTimeout(function () {
                    ar_circlePopup(data);
                }, 1000);
            }
        }
    }

    function statisticPopupReviewAr(object) {

        var myCookies = Object(__WEBPACK_IMPORTED_MODULE_1__statistics_popup_reviews__["a" /* getCookies */])();
        var objProducts = {
            type_page: alireviews_page_type,
            product_id: object.product.id,
            product_title: object.product.title,
            shop_id: object.shop_id,
            review_id: myCookies.review_id,
            product_avatar: object.product.image,
            product_link: typeof object.product.handle != 'undefined' && object.product.handle ? '/products/' + object.product.handle : "",
            type: 'review',
            is_reviews: true,
            reviewPerformance: object.reviewPerformance
        };
        if (typeof object.type_oject != 'undefined' && object.type_oject === 'combo') {
            objProducts.combo_id = object.combo_id;
            objProducts.combo_title = object.combo_title;
        }
        if (alireviews_page_type === 'cart') {
            objProducts.cart_token = myCookies.cart;
        }

        Object(__WEBPACK_IMPORTED_MODULE_1__statistics_popup_reviews__["b" /* statisticReviewPopup */])(objProducts);
        ar_data_statistics_popup_reviews = objProducts;
    }

    //Popup detail
    function clickArrow(event) {
        var count = $(event.target).attr('data-lightbox-key') ? parseInt($(event.target).attr('data-lightbox-key')) + 1 : 1;
        var length = $('.ar-modal-popup-reviews .lc-list-image img').length;
        if (length <= 1) {
            $('.ar-modal-popup-reviews .lc-arrow').css('display', 'none');
        } else {
            $('.ar-modal-popup-reviews .lc-arrow').css('display', 'block');
        }
        $("body").delegate(".ar-modal-popup-reviews .lc-arrow-left", "click", function (e) {
            if (count <= 1) {
                count = length;
            } else {
                count -= 1;
            }
            handleActiveImage(count);
        });
        $("body").delegate(".ar-modal-popup-reviews .lc-arrow-right", "click", function (e) {
            if (count >= length) {
                count = 1;
            } else {
                count += 1;
            }
            handleActiveImage(count);
        });

        $('.ar-modal-popup-reviews .lc-list-thumbnail img').on('click', function (event) {
            count = $(event.target).attr('data-lightbox-key') ? parseInt($(event.target).attr('data-lightbox-key')) + 1 : 1;
            handleActiveImage(count);
        });
    }

    function handleActiveImage(count) {
        $('.lc-list-image img').removeClass('visible-img');
        $('.lc-list-image img:nth-child(' + count + ')').addClass('visible-img');
        $('.lc-list-thumbnail img').removeClass('lc-img-active');
        $('.lc-list-thumbnail img:nth-child(' + count + ')').addClass('lc-img-active');
    }

    function handelListReviewImage(event) {
        var key = $(event.target).attr('data-lightbox-key') ? parseInt($(event.target).attr('data-lightbox-key')) + 1 : 1;
        $('.ar-modal-popup-reviews .lc-list-image img:nth-child(' + key + ')').addClass('visible-img');
        $('.ar-modal-popup-reviews .lc-list-thumbnail img:nth-child(' + key + ')').addClass('lc-img-active');
        clickArrow(event);
    }

    function replacePositionFlagCountry() {
        var ali_country_flag_shape = $('.ali_country_flag_shape').val();
        setTimeout(function () {
            $('.ali-flag-slc').not('.ali-flag-replaced').each(function () {
                var a = $(this).css('backgroundPositionY');
                var b = Number(a.replace(/[^0-9-]/g, ''));
                $(this).addClass('ali-flag-replaced');
                if (ali_country_flag_shape == 'rectangle') {
                    $(this).css({ 'background-position-y': b - 6 + "px" });
                } else if (ali_country_flag_shape == 'circle') {
                    $(this).css({ 'background-position-y': b - 4 + "px" });
                }
            });
        }, 300);
    }
});

/***/ }),

/***/ "./resources/assets_45/js/frontend/statistics-popup-reviews.js":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* unused harmony export configCookieVisitor */
/* unused harmony export setCookie */
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return getCookies; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return statisticReviewPopup; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__config__ = __webpack_require__("./resources/assets_45/js/frontend/config.js");


// export

function getCookies() {
    var shopId = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;
    var product = arguments[1];

    var pairs = document.cookie.split(";");
    var cookies = {};
    for (var i = 0; i < pairs.length; i++) {
        var pair = pairs[i].split("=");
        cookies[(pair[0] + '').trim()] = unescape(pair[1]);
    }
    var data = sessionStorage.getItem('review_id');
    var visitorId = sessionStorage.getItem('visitor_id');
    if ((visitorId !== null || typeof visitorId !== 'undefined') && typeof shopId !== 'undefined') {
        data = visitorId;
        sessionStorage.setItem('review_id', visitorId);
    }
    if ((data === null || typeof data === 'undefined') && typeof shopId !== 'undefined') {
        var review_id = shopId + Date.now().toString() + Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);
        cookies.review_id = review_id;
        sessionStorage.setItem('review_id', review_id);
        sessionStorage.setItem('visitor_id', review_id);
    } else {
        cookies.review_id = sessionStorage.getItem('review_id');
        cookies.visitor_id = sessionStorage.getItem('review_id');
    }
    return cookies;
}

function configCookieVisitor() {
    var time_limit_track_value = Date.now();
    var time_limit_track = 5 * 1000;
    setCookie('time_limit_track', time_limit_track_value, time_limit_track);
    setCookie('review_id', sessionStorage.getItem('review_id'));
    setCookie('visitor_id', sessionStorage.getItem('review_id'));
}

configCookieVisitor();

/**
 *
 * @param {*} cname
 * @param {*} cvalue
 */

function setCookie(cname, cvalue) {
    var time_limit = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;

    var date = new Date();
    if (time_limit !== null) {
        date.setTime(date.getTime() + time_limit);

        var expires = "expires=" + date.toGMTString();

        window.document.cookie = cname + "=" + cvalue + "; " + expires;
    } else {
        window.document.cookie = cname + "=" + cvalue;
    }
}

function statisticReviewPopup() {
    var object = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};


    var Url = __WEBPACK_IMPORTED_MODULE_0__config__["a" /* default */].shop_url + "/reviews_popup/statistic";
    $.ajax({
        type: "GET",
        url: Url,
        data: object,
        dataType: "json",
        success: function success(result) {
            if (result.status && result.cart_token) {
                sessionStorage.setItem('obj_cart', result.cart_token);
            } else if (result.status) {
                sessionStorage.setItem('reviewPerformance', 'true');
                sessionStorage.setItem('is_visitor', sessionStorage.getItem('visitor_id'));
                setCookie('is_visitor', sessionStorage.getItem('visitor_id'));
                if (typeof result.data.href != 'undefined' && result.data.href != null) {
                    if (typeof result.data.target != 'undefined' && result.data.target != null) {
                        var win = window.open(result.data.href, result.data.target);
                        win.focus();
                    }
                }
            }
        }, // success
        error: function error() {} // error
    });
}



/***/ }),

/***/ 2:
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__("./resources/assets_45/js/frontend/popup-reviews.js");


/***/ })

/******/ });